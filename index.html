<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🍽️ אפליקציית אוכל</title>
  
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

          const API_URL = 'https://sheetdb.io/api/v1/hg06ydww33zp6';

    function FoodApp() {
      const [isLoggedIn, setIsLoggedIn] = useState(false);
      const [phone, setPhone] = useState('');
      const [data, setData] = useState([]);
      const [loading, setLoading] = useState(true);
      const [itemsPerPage, setItemsPerPage] = useState(10);
      const [editingId, setEditingId] = useState(null);
      const [editName, setEditName] = useState('');
      const [editFood, setEditFood] = useState('');
      const [saving, setSaving] = useState(false);

      useEffect(() => {
        fetchData();
      }, []);

      const fetchData = async () => {
        try {
          setLoading(true);
          const response = await fetch(API_URL);
          const result = await response.json();
          setData(result || []);
        } catch (error) {
          console.error('Error fetching data:', error);
          alert('שגיאה בטעינת הנתונים');
        } finally {
          setLoading(false);
        }
      };

      const handleLogin = () => {
        if (!phone.trim()) {
          alert('אנא הכנס מספר טלפון');
          return;
        }

        const existingUser = data.find(u => u['טלפון'] === phone);
        if (existingUser) {
          setIsLoggedIn(true);
          setEditName(existingUser['שם'] || '');
          setEditFood(existingUser['מה הוא מביא'] || '');
          setEditingId(phone);
        } else {
          setIsLoggedIn(true);
          setEditName('');
          setEditFood('');
          setEditingId(null);
        }
      };

      const handleLogout = () => {
        setIsLoggedIn(false);
        setPhone('');
        setEditingId(null);
        setEditName('');
        setEditFood('');
      };

      const handleSave = async () => {
        if (!phone.trim() || !editName.trim() || !editFood.trim()) {
          alert('אנא מלא את כל השדות');
          return;
        }

        setSaving(true);
        try {
          const recordData = {
            'טלפון': phone,
            'שם': editName,
            'מה הוא מביא': editFood
          };

          if (editingId) {
            await fetch(`${API_URL}/טלפון/${phone}`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(recordData)
            });
          } else {
            await fetch(API_URL, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(recordData)
            });
          }

          await fetchData();
          handleLogout();
          alert('נשמר בהצלחה! ✅');
        } catch (error) {
          console.error('Error saving data:', error);
          alert('שגיאה בשמירה של הנתונים');
        } finally {
          setSaving(false);
        }
      };

      const handleEdit = (item) => {
        setPhone(item['טלפון']);
        setEditName(item['שם']);
        setEditFood(item['מה הוא מביא']);
        setEditingId(item['טלפון']);
        setIsLoggedIn(true);
      };

      const itemsToShow = data.slice(0, itemsPerPage);

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 p-4">
          <div className="max-w-4xl mx-auto">
            <div className="text-center mb-8 mt-4">
              <h1 className="text-4xl font-bold text-gray-800 mb-2">🍽️ אפליקציית נתינת אוכל</h1>
              <p className="text-gray-600">רשום מה אתה מביא לאירוע</p>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div className="md:col-span-2">
                <div className="bg-white rounded-lg shadow-lg p-6">
                  <h2 className="text-2xl font-bold text-gray-800 mb-4">📊 כל ההגשות</h2>
                  
                  <div className="flex gap-2 mb-4">
                    <button 
                      onClick={() => setItemsPerPage(10)}
                      className={`px-4 py-2 rounded transition ${itemsPerPage === 10 ? 'bg-purple-600 text-white' : 'bg-gray-200 hover:bg-gray-300'}`}
                    >
                      10 שורות
                    </button>
                    <button 
                      onClick={() => setItemsPerPage(data.length)}
                      className={`px-4 py-2 rounded transition ${itemsPerPage === data.length ? 'bg-purple-600 text-white' : 'bg-gray-200 hover:bg-gray-300'}`}
                    >
                      הכל
                    </button>
                  </div>

                  {loading ? (
                    <div className="flex items-center justify-center py-8">
                      <span className="text-gray-600">⏳ טוען נתונים...</span>
                    </div>
                  ) : (
                    <>
                      <div className="overflow-x-auto">
                        <table className="w-full text-right">
                          <thead>
                            <tr className="border-b-2 border-purple-600">
                              <th className="p-3 text-purple-600 font-bold">שם</th>
                              <th className="p-3 text-purple-600 font-bold">מה הוא מביא</th>
                              <th className="p-3 text-purple-600 font-bold">פעולה</th>
                            </tr>
                          </thead>
                          <tbody>
                            {itemsToShow.length > 0 ? (
                              itemsToShow.map((item, idx) => (
                                <tr key={idx} className="border-b hover:bg-gray-50 transition">
                                  <td className="p-3">{item['שם'] || '-'}</td>
                                  <td className="p-3">{item['מה הוא מביא'] || '-'}</td>
                                  <td className="p-3">
                                    <button
                                      onClick={() => handleEdit(item)}
                                      className="text-blue-600 hover:text-blue-800 font-bold transition"
                                    >
                                      ✏️ עדכן
                                    </button>
                                  </td>
                                </tr>
                              ))
                            ) : (
                              <tr>
                                <td colSpan="3" className="p-3 text-center text-gray-500">
                                  אין נתונים עדיין
                                </td>
                              </tr>
                            )}
                          </tbody>
                        </table>
                      </div>

                      <p className="text-gray-600 text-sm mt-4">סה"כ: {data.length} הגשות</p>
                    </>
                  )}
                </div>
              </div>

              <div>
                <div className="bg-white rounded-lg shadow-lg p-6 sticky top-4">
                  <h3 className="text-xl font-bold text-gray-800 mb-4">
                    {isLoggedIn ? '✏️ עדכן את הגשתך' : '🔐 התחברות'}
                  </h3>

                  {!isLoggedIn ? (
                    <div className="space-y-3">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">
                          מספר טלפון
                        </label>
                        <input
                          type="tel"
                          value={phone}
                          onChange={(e) => setPhone(e.target.value)}
                          placeholder="050-1234567"
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600"
                        />
                      </div>
                      <button
                        onClick={handleLogin}
                        className="w-full bg-purple-600 text-white py-2 rounded-lg font-bold hover:bg-purple-700 transition"
                      >
                        התחברות
                      </button>
                    </div>
                  ) : (
                    <div className="space-y-3">
                      <div className="bg-gray-100 p-2 rounded text-sm text-gray-600 mb-3">
                        📱 {phone}
                      </div>
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">
                          שמך
                        </label>
                        <input
                          type="text"
                          value={editName}
                          onChange={(e) => setEditName(e.target.value)}
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">
                          מה אתה מביא?
                        </label>
                        <input
                          type="text"
                          value={editFood}
                          onChange={(e) => setEditFood(e.target.value)}
                          placeholder="לדוגמה: סלט, עוגה..."
                          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-600"
                        />
                      </div>
                      <button
                        onClick={handleSave}
                        disabled={saving}
                        className="w-full bg-green-600 text-white py-2 rounded-lg font-bold hover:bg-green-700 transition disabled:bg-gray-400"
                      >
                        {saving ? '💾 שומר...' : '💾 שמור'}
                      </button>
                      <button
                        onClick={handleLogout}
                        className="w-full bg-red-600 text-white py-2 rounded-lg font-bold hover:bg-red-700 transition"
                      >
                        התנתקות
                      </button>
                    </div>
                  )}
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<FoodApp />, document.getElementById('root'));
  </script>
</body>
</html>
